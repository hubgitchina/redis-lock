# redis-lock

在互联网软件产品应用中，多用户同时在线，同时访问系统资源是很常见的情况，然而在多应用多线程的高并发访问时，对临界资源、共享资源等数据，如果不做处理，则会出现并发冲突和读取脏数据或数据更新覆盖，导致用户最终看到的数据，或操作的数据，出现问题，严重影响用户体验，从而降低产品对用户的黏性。

使用Redis实现分布式锁，目前主流解决方案都是通过Redis的SETNX命令和时间戳来实现加锁，然后却存在很大漏洞，因为在高并发情况下，分布式环境中，服务器宕机或是多线程争抢锁资源时，还是会出现死锁或锁获取不一致等问题。故进一步改进为加锁标识为“时间戳+服务器MAC地址+JAVA虚拟机ID+当前线程ID”，这样确保了加锁线程身份识别不会出错的问题，同时增加隐藏加锁标识记录当前加锁线程的标识，防止在多线程争抢锁资源时发生错漏等问题，再加上统一使用服务器时间和睡眠机制，最终在保证性能的同时，达到谁加锁谁才能解锁，时间戳过期自动解锁，争抢锁时，先到先得，不会发生错位误删等情况发生。
